# Milvus OpenTelemetry Integration Demo (Python)

This project demonstrates how to integrate OpenTelemetry (OTEL) tracing in a Milvus Python application. It showcases the setup and configuration required to send traces from a Milvus client to Jaeger for visualization and analysis.

## Prerequisites

- Python 3.7 or higher
- pip
- Docker and Docker Compose

## Getting Started

### 1. Start Milvus and Jaeger

Use Docker Compose to start Milvus and Jaeger:

```bash
docker-compose up -d
```

This will start:

- **Milvus**: A vector database  
- **Jaeger**: A distributed tracing system

### 2. Set Up the Python Environment

Create a virtual environment and install the required packages:

```bash
python -m venv venv
source venv/bin/activate  # On Windows use `venv\Scripts\activate`
pip install -r requirements.txt
```

### 3. Run the Demo

To run the demo with OTEL tracing enabled and sending data to Jaeger:

```bash
pytest test/test_milvus_otel.py
```

This command runs the tests with OpenTelemetry tracing configured to send traces to Jaeger.

### 4. View Traces

Open the Jaeger UI in your web browser:

[http://localhost:16686](http://localhost:16686)

Select the `milvus-client` service to view the traces generated by the demo.

## Project Structure

- `test/test_milvus_otel.py`: Contains the test demonstrating Milvus operations with OTEL tracing.
- `docker-compose.yml`: Defines the Milvus and Jaeger services.
- `requirements.txt`: Lists the Python dependencies.

## Configuration

The OpenTelemetry configuration is set through environment variables and code in the test file. Key configurations include:

- **OTLP exporter endpoint**: `http://localhost:4317`
- **Service name**: `milvus-client`
- **Resource attributes**: `application=milvus-otel-test`

## Additional Notes

- Make sure ports **19530** (Milvus), **16686** (Jaeger UI), and **4317** (Jaeger OTLP gRPC) are available on your system.
- The demo uses **Milvus version 2.5.11** and **Jaeger version 1.46.0**.

## Troubleshooting

If you encounter any issues:

1. Ensure all required ports are free.
2. Check Docker logs for any startup errors:

    ```bash
    docker-compose logs
    ```

3. Verify that Milvus and Jaeger are running:

    ```bash
    docker-compose ps
    ```

## References

For more detailed information about Milvus or OpenTelemetry, refer to their respective documentation.

## Trace Example

Below is an example of the trace result shown in Jaeger:

![Jaeger Trace Example](doc/jaeger.png)
